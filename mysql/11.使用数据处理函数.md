### 使用数据处理函数
本章介绍什么是函数，MySQL支持何种函数，以及如何使用这些函数。

#### 11.1 函数
与其他大多数计算机语言一样，SQL支持利用函数来处理数据。函数 一般是在数据上执行的，它给数据的转换和处理提供了方便。

#### 11.2 使用函数
大多数SQL实现支持以下类型的函数。

 用于处理文本串(如删除或填充值，转换值为大写或小写)的文本函数。
 用于在数值数据上进行算术操作(如返回绝对值，进行代数运算)的数值函数。
 用于处理日期和时间值并从这些值中提取特定成分(例如，返回两个日期之差，检查日期有效性等)的日期和时间函数。
 返回DBMS正使用的特殊信息(如返回用户登录信息，检查版本细节)的系统函数。

#### 11.2.1 文本处理函数

其中使用RTrim()函数来去除列值右边的空格。下面是另一个例子，这次使用Upper()函数:
* 输入：`select pro_name ,  Upper(pro_name) as pro_name_upper from products;`
* 输出：pro_name="nicofh"  pro_name_upper='NICOFH'

*  函数    说明
* Left() 返回串左边的字符 
* Length() 返回串的长度 
* Locate() 找出串的一个子串 
* Lower() 将串转换为小写 
* LTrim() 去掉串左边的空格 
* Right() 返回串右边的字符 
* RTrim() 去掉串右边的空格 
* Soundex() 返回串的SOUNDEX值 
* SubString() 返回子串的字符 
* Upper() 将串转换为大写


> 表11-1中的SOUNDEX需要做进一步的解释。SOUNDEX是一个将任何文 本串转换为描述其语音表示的字母数字模式的算法。SOUNDEX考虑了类似 的发音字符和音节，使得能对串进行发音比较而不是字母比较。虽然 SOUNDEX不是SQL概念，但MySQL(就像多数DBMS一样)都提供对 SOUNDEX的支持。

现在试一下使用Soundex()函数进行搜索，它匹配所有发音类似于 Y.Lie的联系名


* 输入： `select name from products where Soundex(name)=Soundex(Y.Lie);`
* 分析： 在这个例子中，WHERE子句使用Soundex()函数来转换cust_contact列值和搜索串为它们的SOUNDEX值。因为Y.Lee和 Y.Lie发音相似，所以它们的SOUNDEX值匹配，因此WHERE子句正确地过滤 出了所需的数据。


#### 11.2.2 日期和时间处理函数
日期和时间采用相应的数据类型和特殊的格式存储，以便能快速和有效地排序或过滤，并且节省物理存储空间。

表11-2列出了某些常用的日期和时间处理函数。
* AddDate() 增加一个日期(天、周等)
* AddTime() 增加一个时间(时、分等)
* CurDate() 返回当前日期
* CurTime() 返回当前时间
* Date()    返回日期时间的日期部分
* DateDiff() 计算两个日期之差
* Date_Add() 高度灵活的日期运算函数
* Date_Format() 返回一个格式化的日期或时间串
* Day()   返回一个日期的天数部分
* DayOfWeek() 对于一个日期，返回对应的星期几
* Hour()  返回一个时间的小时部分
* Minute() 返回一个时间的分钟部分
* Month() 返回一个日期的月份部分
* Now() 返回当前日期和时间
* Second() 返回一个时间的秒部分
* Time() 返回一个日期时间的时间部分
* Year() 返回一个日期的年份部分

迄今为止，我 们都是用比较数值和文本的WHERE子句过滤数据，但数据经常需要用日 期进行过滤。用日期进行过滤需要注意一些别的问题和使用特殊的 MySQL函数。

因此，基本的日期比较应该很简单:
* 输入：`select id,order_num from orders where order_date='2015-09-01';`
* 输出：此SELECT语句正常运行。它检索出一个订单记录，该订单记录 的order_date为2005-09-01。

但是，使用WHERE order_date = '2005-09-01'可靠吗?order_ date的数据类型为datetime。这种类型存储日期及时间值。样例表中 的值全都具有时间值00:00:00，但实际中很可能并不总是这样。如果 用当前日期和时间存储订单日期(因此你不仅知道订单日期，还知道 下订单当天的时间)，怎么办?比如，存储的order_date值为 2005-09-01 11:30:05，则WHERE order_date = '2005-09-01'失败。 即使给出具有该日期的一行，也不会把它检索出来，因为WHERE匹配失 败。
解决办法是指示MySQL仅将给出的日期与列中的日期部分进行比较，而不是将给出的日期与整个列值进行比较。为此，必须使用`Date()` 函数。`Date(order_date)`指示

MySQL仅提取列的日期部分，更可靠的 SELECT语句为:

* 输入：`select id,order_num from orders Date(order_date)='2015-09-01';`
* 分析： 这样才返回正确时间订单

> 如果要的是日期，请使用Date() 如果你想要的仅是日期， 则使用Date()是一个良好的习惯，即使你知道相应的列只包 含日期也是如此。这样，如果由于某种原因表中以后有日期和 时间值，你的SQL代码也不用改变。当然，也存在一个Time() 函数，在你只想要时间时应该使用它。Date()和Time()都是在MySQL 4.1.1中第一次引入的。

如果你想检索出2005年9月下的 所有订单，怎么办?简单的相等测试不行，因为它也要匹配月份中的天数。有几种解决办法，其中之一如下所示:

* 输出：`select ord_id,ord_num from orders Date(order_date) between '2015-09-01' and '2015-09-30';`
* 输出 9月份所以单据

还有另外一种办法(一种不需要记住每个月中有多少天或不需要操心闰年2月的办法):
* 输出 `select ord_id,ord_num from orders where Year(order_date)=2015 and Month(order_date)=9;`
* 输出 9月份所以单据


#### 11.2.3 数值处理函数
* Abs()  绝对值
* cos()  余弦

#### 11.3 小结
本章介绍了如何使用SQL的数据处理函数，并着重介绍了日期处理函数。












 
### 用正则表达式进行搜索 
本章将学习如何在MySQL WHERE子句内使用正则表达式来更好地控制数据过滤。 和其他语言正则都是一样

#### 9.1 正则表达式介绍
《正则表达式必知必会》

#### 9.2 使用mysql正则表达式
仅为正则表达式语言的一个子集,如果你熟悉正则表达式，需要注意:MySQL仅支持多数正则表达式实现的一个很小的子集。本章介绍MySQL支持的大多数内容

#### 9.2.1 基本字符匹配
我们从一个非常简单的例子开始。下面的语句检索列prod_name包含文本1000的所有行:

* 输入：`select pro_name form products where pro_name REGEXP '1000' order bt pro_name;`
* 分析：除关键字LIKE被REGEXP替代外，这条语句看上去非常像使用LIKE的语句(第8章)。它告诉MySQL:REGEXP后所跟的东西作 为正则表达式(与文字正文1000匹配的一个正则表达式)处理。

为什么要费力地使用正则表达式?在刚才的例子中，正则表达式确实没有带来太多好处(可能还会降低性能)，不过，请考虑下面的例子:

* 输入：`select pro_name form products where pro_name REGEXP '.000' order bt pro_name;`
* 输出：这里使用了正则表达式.000。.是正则表达式语言中一个特殊的字符。它表示匹配任意一个字符，因此，1000和2000都匹配 且返回。

* LIKE与REGEXP 在LIKE和REGEXP之间有一个重要的差别:
* LIKE匹配整个列。如果被匹配的文本在列值 中出现，LIKE将不会找到它，相应的行也不被返回(除非使用 通配符)。
* 而REGEXP在列值内进行匹配，如果被匹配的文本在 列值中出现，REGEXP将会找到它，相应的行将被返回。这是一个非常重要的差别。
* REGEXP使用^和$定位符可以匹配整列文本

#### 9.2.2 进行OR匹配
为搜索两个串之一(或者为这个串，或者为另一个串)，使用|，如下所示

* 输出：`select pro_name from products where pro_name REGEXP '1000|2000' order by pro_name;`
* 分析 语句中使用了正则表达式1000|2000。|为正则表达式的OR操作 符。它表示匹配其中之一，因此1000和2000都匹配并返回。


#### 9.2.3 匹配几个字符之一
匹配任何单一字符

* 输出：`selet pro_name from products where pro_name REXGEP '[123] TOM' order by pro_name;`
* 输出 '1 TOM ***' '2 TOM ***' '3 TOM ***'
* 分析 正如所见，[]是另一种形式的OR语句。事实上，正则表达式[123]Ton 为[1|2|3]Ton的缩写，也可以使用后者


#### 9.2.4 匹配范围
集合可用来定义要匹配的一个或多个字符。

* 输出：`selet pro_name from products where pro_name REXGEP '[0-9] TOM' order by pro_name;`
* 输出 '1 TOM ***' '2 TOM ***' '3 TOM ***'  。。。。
* 分析 这里使用正则表达式[1-5] Ton。[1-5]定义了一个范围，这个表达式意思是匹配1到5，因此返回3个匹配行。由于5 ton匹配， 所以返回.5 ton。

#### 9.2.5 匹配特殊字符

为了匹配特殊字符，必须用\\为前导。\\-表示查找-，\\.表示查找.。

* 输出：`selet pro_name from products where pro_name REXGEP '\\.' order by pro_name;`
* 输出： pro_name='nice .'
* 分析： 这种处理就是所谓的转义(escaping)，正则表达式内具有特殊意义的所 有字符都必须以这种方式转义。这包括.、|、[]以及迄今为止使用过的 其他特殊字符。

> 匹配\ 为了匹配反斜杠(\)字符本身，需要使用\\\。

#### 9.2.6 匹配字符类

#### 9.2.7 匹配多个实例

* 输入：`select pro_name from products where pro_name REGEXP '\\([0-9] sticks?\\)'`
* 输出：pro_name=(1 stick) pro_name=(2 sticks)
* 分析：正则表达式\\([0-9] sticks?\\)需要解说一下。\\(匹配)，[0-9]匹配任意数字(这个例子中为1和5)，sticks?匹配stick 和sticks(s后的?使s可选，因为?匹配它前面的任何字符的0次或1次出现)，\\)匹配)。没有?，匹配stick和sticks会非常困难。

#### 9.2.8 定位符
目前为止的所有例子都是匹配一个串中任意位置的文本。为了匹配特定位置的文本，需要使用表9-4列出的定位符。
^ 开头定位符， $结尾定位符。

* 输入：`select pro_name from products where pro_name REGEXP '^ [0-9\\.]';`
* 分析：^匹配串的开始。因此，^[0-9\\.]只在.或任意数字为串中第一个字符时才匹配它们。没有^，则还要多检索出4个别的行(那 些中间有数字的行)。
> ^的双重用途 ^有两种用法。在集合中(用[和]定义)，用它 来否定该集合，否则，用来指串的开始处。

> 使REGEXP起类似LIKE的作用 本章前面说过，LIKE和REGEXP 的不同在于，LIKE匹配整个串而REGEXP匹配子串。利用定位 符，通过用^开始每个表达式，用$结束每个表达式，可以使 REGEXP的作用与LIKE一样。

> 简单的正则表达式测试 可以在不使用数据库表的情况下用 SELECT来测试正则表达式。REGEXP检查总是返回0(没有匹配) 或1(匹配)。可以用带文字串的REGEXP来测试表达式，并试 验它们。相应的语法如下:
  `select hello REGEXP '[0-9]';`
  这个例子显然将返回0(因为文本hello中没有数字)。
  
#### 9.3 小结
本章介绍了正则表达式的基础知识，学习了如何在MySQL的SELECT语句中通过REGEXP关键字使用它们。










